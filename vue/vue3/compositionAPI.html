<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Composition API | 荣佳主页</title>
    <meta name="description" content="荣佳的前端记录">
    <link rel="icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.55399c08.css" as="style"><link rel="preload" href="/assets/js/app.ce52274a.js" as="script"><link rel="preload" href="/assets/js/2.86be4830.js" as="script"><link rel="preload" href="/assets/js/72.4039c758.js" as="script"><link rel="prefetch" href="/assets/js/10.5c735ce7.js"><link rel="prefetch" href="/assets/js/11.31f00805.js"><link rel="prefetch" href="/assets/js/12.f94a697a.js"><link rel="prefetch" href="/assets/js/13.a75f95df.js"><link rel="prefetch" href="/assets/js/14.48475b07.js"><link rel="prefetch" href="/assets/js/15.aa0f3dab.js"><link rel="prefetch" href="/assets/js/16.9f1ab77b.js"><link rel="prefetch" href="/assets/js/17.86e3db7b.js"><link rel="prefetch" href="/assets/js/18.acf6a743.js"><link rel="prefetch" href="/assets/js/19.0fb6aedf.js"><link rel="prefetch" href="/assets/js/20.1eff8f4a.js"><link rel="prefetch" href="/assets/js/21.eb4e757e.js"><link rel="prefetch" href="/assets/js/22.3b35b589.js"><link rel="prefetch" href="/assets/js/23.dab33bef.js"><link rel="prefetch" href="/assets/js/24.86a2763e.js"><link rel="prefetch" href="/assets/js/25.29ba0bad.js"><link rel="prefetch" href="/assets/js/26.c9481831.js"><link rel="prefetch" href="/assets/js/27.9e45850c.js"><link rel="prefetch" href="/assets/js/28.e7b70545.js"><link rel="prefetch" href="/assets/js/29.d778e45b.js"><link rel="prefetch" href="/assets/js/3.469c037b.js"><link rel="prefetch" href="/assets/js/30.df4ea074.js"><link rel="prefetch" href="/assets/js/31.a022c692.js"><link rel="prefetch" href="/assets/js/32.a3de065d.js"><link rel="prefetch" href="/assets/js/33.73f016f8.js"><link rel="prefetch" href="/assets/js/34.74febe24.js"><link rel="prefetch" href="/assets/js/35.3f6431e5.js"><link rel="prefetch" href="/assets/js/36.db7d7c9e.js"><link rel="prefetch" href="/assets/js/37.788bdeac.js"><link rel="prefetch" href="/assets/js/38.58c8b2b8.js"><link rel="prefetch" href="/assets/js/39.e38e9e60.js"><link rel="prefetch" href="/assets/js/4.b123464e.js"><link rel="prefetch" href="/assets/js/40.939482f4.js"><link rel="prefetch" href="/assets/js/41.25694efb.js"><link rel="prefetch" href="/assets/js/42.6d057bcb.js"><link rel="prefetch" href="/assets/js/43.91c27b9b.js"><link rel="prefetch" href="/assets/js/44.718ddf52.js"><link rel="prefetch" href="/assets/js/45.5efb5a8b.js"><link rel="prefetch" href="/assets/js/46.bf8ce01b.js"><link rel="prefetch" href="/assets/js/47.772dc96d.js"><link rel="prefetch" href="/assets/js/48.bd7fa440.js"><link rel="prefetch" href="/assets/js/49.498933dc.js"><link rel="prefetch" href="/assets/js/5.8ac08087.js"><link rel="prefetch" href="/assets/js/50.a6b85238.js"><link rel="prefetch" href="/assets/js/51.4165d4ea.js"><link rel="prefetch" href="/assets/js/52.869453e0.js"><link rel="prefetch" href="/assets/js/53.44d476a8.js"><link rel="prefetch" href="/assets/js/54.9827a88a.js"><link rel="prefetch" href="/assets/js/55.17304c96.js"><link rel="prefetch" href="/assets/js/56.7e15dca0.js"><link rel="prefetch" href="/assets/js/57.81d9ecb6.js"><link rel="prefetch" href="/assets/js/58.af0da988.js"><link rel="prefetch" href="/assets/js/59.357073c2.js"><link rel="prefetch" href="/assets/js/6.fca1a248.js"><link rel="prefetch" href="/assets/js/60.e64bd2eb.js"><link rel="prefetch" href="/assets/js/61.c665d89a.js"><link rel="prefetch" href="/assets/js/62.d43af2c4.js"><link rel="prefetch" href="/assets/js/63.180170c9.js"><link rel="prefetch" href="/assets/js/64.8c99c6b3.js"><link rel="prefetch" href="/assets/js/65.3618730d.js"><link rel="prefetch" href="/assets/js/66.ea3fd092.js"><link rel="prefetch" href="/assets/js/67.052d07e9.js"><link rel="prefetch" href="/assets/js/68.2a44f092.js"><link rel="prefetch" href="/assets/js/69.a49e0555.js"><link rel="prefetch" href="/assets/js/7.8ebd2c73.js"><link rel="prefetch" href="/assets/js/70.0a3c20d2.js"><link rel="prefetch" href="/assets/js/71.e0bdf0d3.js"><link rel="prefetch" href="/assets/js/73.63387f12.js"><link rel="prefetch" href="/assets/js/74.c8b7bf8b.js"><link rel="prefetch" href="/assets/js/75.0066401c.js"><link rel="prefetch" href="/assets/js/76.662c35a6.js"><link rel="prefetch" href="/assets/js/77.8ba442f3.js"><link rel="prefetch" href="/assets/js/8.dda93801.js"><link rel="prefetch" href="/assets/js/9.9502aa7c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55399c08.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img.jpg" alt="荣佳主页" class="logo"> <span class="site-name can-hide">荣佳主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">Vue</a></li><li class="dropdown-item"><!----> <a href="/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/nodeJs/" class="nav-link">nodeJs</a></li><li class="dropdown-item"><!----> <a href="/jQuery/" class="nav-link">JQuery</a></li><li class="dropdown-item"><!----> <a href="/javaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/typeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/webInterview/" class="nav-link">Web面试题</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/rjluck/rongjia-knowledge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">Vue</a></li><li class="dropdown-item"><!----> <a href="/MongoDB/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/nodeJs/" class="nav-link">nodeJs</a></li><li class="dropdown-item"><!----> <a href="/jQuery/" class="nav-link">JQuery</a></li><li class="dropdown-item"><!----> <a href="/javaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/typeScript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/webInterview/" class="nav-link">Web面试题</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://github.com/rjluck/rongjia-knowledge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue3</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vue3/base.html" class="sidebar-link">初识vue3</a></li><li><a href="/vue/vue3/compositionAPI.html" aria-current="page" class="active sidebar-link">Composition API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#初始setup" class="sidebar-link">初始setup</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#ref函数" class="sidebar-link">ref函数</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#reactive函数" class="sidebar-link">reactive函数</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#vue3中的响应式原理" class="sidebar-link">vue3中的响应式原理</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#reactive对比ref" class="sidebar-link">reactive对比ref</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#setup的两个注意点" class="sidebar-link">setup的两个注意点</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#计算属性与监视" class="sidebar-link">计算属性与监视</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#自定义hooks函数" class="sidebar-link">自定义hooks函数</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#toref" class="sidebar-link">toRef</a></li><li class="sidebar-sub-header"><a href="/vue/vue3/compositionAPI.html#composition-api的优势" class="sidebar-link">Composition API的优势</a></li></ul></li><li><a href="/vue/vue3/otherComAPI.html" class="sidebar-link">other Composition API</a></li><li><a href="/vue/vue3/component.html" class="sidebar-link">新的组件</a></li><li><a href="/vue/vue3/other.html" class="sidebar-link">其他</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="composition-api"><a href="#composition-api" class="header-anchor">#</a> Composition API</h1> <p></p><div class="table-of-contents"><ul><li><a href="#初始setup">初始setup</a></li><li><a href="#ref函数">ref函数</a></li><li><a href="#reactive函数">reactive函数</a></li><li><a href="#vue3中的响应式原理">vue3中的响应式原理</a><ul><li><a href="#vue2的响应式">vue2的响应式</a></li><li><a href="#vue3的响应式">vue3的响应式</a></li><li><a href="#window-reflect-反射对象">window.Reflect 反射对象</a></li></ul></li><li><a href="#reactive对比ref">reactive对比ref</a></li><li><a href="#setup的两个注意点">setup的两个注意点</a></li><li><a href="#计算属性与监视">计算属性与监视</a><ul><li><a href="#computed函数">computed函数</a></li><li><a href="#watch函数">watch函数</a></li><li><a href="#watcheffect函数">watchEffect函数</a></li></ul></li><li><a href="#生命周期">生命周期</a></li><li><a href="#自定义hooks函数">自定义hooks函数</a><ul><li><a href="#什么是hook">什么是hook?</a></li></ul></li><li><a href="#toref">toRef</a></li><li><a href="#composition-api的优势">Composition API的优势</a><ul><li><a href="#options-api-存在的问题">Options API 存在的问题</a></li><li><a href="#composition-api-的优势">Composition API 的优势</a></li></ul></li></ul></div><p></p> <h2 id="初始setup"><a href="#初始setup" class="header-anchor">#</a> 初始setup</h2> <ul><li>理解：<code>vue3</code>中的一个新的配置，值为一个函数。</li> <li><code>setup</code>是所有<code>Composition API（组合API）</code>“表演的舞台”。</li> <li>组件中所用到的：数据、方法等等，均要配置在<code>setup</code>中。</li> <li><code>setup</code>函数的两种返回值：
<ul><li>若返回一个对象，则对象中的属性、方法，在模板中均可以直接使用（重点关注）。</li> <li>若返回一个渲染函数：则可以自定义渲染内容（了解）。</li></ul></li> <li>注意点
<ul><li>尽量不要与<code>vue2</code>配置混用
<ul><li><code>vue2</code>配置(data、methods、computed...)中可以访问到setup中的属性、方法。</li> <li>但在setup中不能访问到<code>vue2</code>配置(data、methods、computed...)。</li> <li>如果有重名，<code>setup</code>优先。</li></ul></li> <li><code>setup</code>不能是一个<code>async</code>函数，因为返回值不再是<code>return</code>的对象，而是<code>promise</code>，模板看不到<code>return</code>对象中的属性。（setup也可以返回一个Promise实例，但是需要Suspense和异步组件的配合）</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sayHello<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>说话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>h<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// setup:function(){}</span>
  <span class="token comment">// 此处只是测试一下setup,暂时不考虑响应式的问题</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 数据</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'张三'</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">我叫</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,我</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">岁了</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回一个对象</span>
    <span class="token comment">// return{</span>
    <span class="token comment">//   name,</span>
    <span class="token comment">//   age,</span>
    <span class="token comment">//   sayHello</span>
    <span class="token comment">// }</span>

    <span class="token comment">// 返回一个渲染函数</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span><span class="token string">'xxxx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="ref函数"><a href="#ref函数" class="header-anchor">#</a> ref函数</h2> <p>把变量丢给ref函数，从而生成引用实现的实例对象，简称引用对象，RefImpl(reference implement) 引用实现。</p> <ul><li>作用：定义一个响应式的数据</li> <li>语法：<code>const xxx = ref(intValue)</code> <ul><li>创建一个包含响应式数据的引用对象（reference对象，简称ref对象）</li> <li>JS中操作数据：<code>xxx.value</code></li> <li>模板中读取数据：不需要<code>.value</code>,直接<code>&lt;div&gt;&lt;/div&gt;</code></li></ul></li> <li>备注
<ul><li>接收的数据可以是：基本类型，也可以是对象类型。</li> <li>基本类型的数据：响应式依然是靠<code>Object.defineProperty()</code>的<code>get</code>和<code>set</code>完成的。</li> <li>对象类型的数据：内部&quot;求助&quot;了Vue3中的一个新函数——<code>reactive</code>函数。</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>工作种类{{job.type}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>工作薪水{{job.salary}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changeInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改人的信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 响应式数据</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> job <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span><span class="token string">'前端工程师'</span><span class="token punctuation">,</span>
      salary<span class="token operator">:</span><span class="token string">'30k'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword">function</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// RefImpl{......value } 实例对象,通过Object.defineProperty 实现</span>
      name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span>
      age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Proxy{} 实例对象，通过Object.proxy实现</span>
      job<span class="token punctuation">.</span>value<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'UI设计师'</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回一个对象</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
      name<span class="token punctuation">,</span>
      age<span class="token punctuation">,</span>
      changeInfo
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="reactive函数"><a href="#reactive函数" class="header-anchor">#</a> reactive函数</h2> <ul><li>作用：定义一个<strong>对象类型</strong>的响应式数据（基本类型别用它，用<code>ref</code>函数）</li> <li>语法：<code>const 代理对象 = reactive(源对象)</code>接收一个对象（或数组），返回一个<strong>代理对象（Proxy的实例对象，简称Proxy对象）</strong></li> <li><code>reactive</code>定义的响应式数据是“深层次的”。</li> <li>内部基于<code>ES6</code>的<code>Proxy</code>实现，通过代理对象操作源对象内部数据进行操作。</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>工作种类{{job.type}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>工作薪水{{job.salary}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changeInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改人的信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 响应式数据</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> job <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span><span class="token string">'前端工程师'</span><span class="token punctuation">,</span>
      salary<span class="token operator">:</span><span class="token string">'30k'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> hobby <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'抽烟'</span><span class="token punctuation">,</span><span class="token string">'喝酒'</span><span class="token punctuation">,</span><span class="token string">'烫头'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword">function</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// RefImpl{......value } 实例对象,通过Object.defineProperty 实现</span>
      name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span>
      age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Proxy{} 实例对象，通过Object.proxy实现</span>
      job<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'UI设计师'</span>

      hobby<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'学习'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回一个对象</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
      name<span class="token punctuation">,</span>
      age<span class="token punctuation">,</span>
      changeInfo
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue3中的响应式原理"><a href="#vue3中的响应式原理" class="header-anchor">#</a> vue3中的响应式原理</h2> <h3 id="vue2的响应式"><a href="#vue2的响应式" class="header-anchor">#</a> vue2的响应式</h3> <ul><li>实现原理
<ul><li>对象类型：通过<code>Object.defineProperty()</code>对属性的读取、修改进行拦截（数据劫持）。</li> <li>数组类型：通过重写更新数组的一系列方法来实现拦截。（对数组的变更方法进行了包裹）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token string">'count'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li>存在问题
<ul><li>新增属性、删除属性，界面不会更新。</li> <li>直接通过下标修改数组，界面不会自动更新。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 新增属性不识别，用$set</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span>
<span class="token comment">// 或</span>
Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span>


<span class="token comment">// 删除属性不识别，用$delete</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'www'</span><span class="token punctuation">)</span>
<span class="token comment">// 或</span>
Vue<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'www'</span><span class="token punctuation">)</span>

<span class="token comment">// 解决数组下标问题</span>
<span class="token comment">// this.person.hobby[0] = '逛街'</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">.</span>hobby<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'逛街'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>person<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'逛街'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="vue3的响应式"><a href="#vue3的响应式" class="header-anchor">#</a> vue3的响应式</h3> <ul><li>实现原理
<ul><li>通过<code>Proxy(代理)</code>：拦截对象中任意属性的变化，包括：属性值的读写、属性的添加、属性的删除等。</li> <li>通过<code>Reflect(反射)</code>：对源对象的属性进行操作。</li> <li>MDN文档中描述的<code>Proxy</code>与<code>Reflect</code>：
<ul><li><code>Proxy</code>:https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</li> <li><code>Reflect</code>:https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token comment">// 拦截读取属性值</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>prop<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>prop<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 拦截设置属性值或添加新属性</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>prop<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 拦截删除属性</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>prop</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>模拟vue2中实现响应式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 源数据</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>


<span class="token comment">// 模拟vue2中实现响应式</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  configurable<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 有人读取name时调用</span>
    <span class="token keyword">return</span> person<span class="token punctuation">.</span>name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 有人修改name时调用</span>
    person<span class="token punctuation">.</span>name <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>模拟vue3中实现响应式</p> <ul><li>Proxy 代理对象</li> <li>Reflect 反射对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 源数据</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>


<span class="token comment">// 模拟vue3中实现响应式</span>
<span class="token comment">// window.Proxy</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// target 源数据</span>
    <span class="token comment">// propName 属性名</span>
    <span class="token comment">// 有人读取了p身上的某个属性</span>
    <span class="token comment">// return target[propName]</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// 有人新增/修改了p身上的某个属性，我要去更新界面了</span>
    <span class="token comment">//  target[propName] = value;</span>
     <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>propName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// 有人删除了p身上的某个属性，我要去更新界面了</span>
    <span class="token comment">// return delete target[propName]</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>propName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="window-reflect-反射对象"><a href="#window-reflect-反射对象" class="header-anchor">#</a> window.Reflect 反射对象</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>

<span class="token comment">// 读取a</span>
<span class="token comment">// 方式1：obj.a</span>
<span class="token comment">// 方式2：Reflect.get(obj,'a')</span>


<span class="token comment">// 修改</span>
<span class="token comment">// 方式1：obj.a = 100</span>
<span class="token comment">// 方式2：Reflect.set(obj,'a',666)</span>

<span class="token comment">// 删除</span>
<span class="token comment">// 方式1：delete obj.a</span>
<span class="token comment">// 方式2：Reflect.deleteProperty(obj,'a')</span>
</code></pre></div><p><code>ECMA</code>组织正在尝试将<code>Object</code>身上的属性移植到<code>Reflect</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>

<span class="token comment">// 1.通过Object.defineProperty操作</span>

<span class="token comment">// 重复定义。报错</span>
<span class="token comment">// Object.defineProperty(obj,'c',{</span>
<span class="token comment">//   get(){</span>
<span class="token comment">//     return 3</span>
<span class="token comment">//   }</span>
<span class="token comment">// })</span>
<span class="token comment">// Object.defineProperty(obj,'c',{</span>
<span class="token comment">//   get(){</span>
<span class="token comment">//     return 4</span>
<span class="token comment">//   }</span>
<span class="token comment">// })</span>

<span class="token comment">// 捕获错误用try catch麻烦</span>
<span class="token comment">// try{</span>
<span class="token comment">//   Object.defineProperty(obj,'c',{</span>
<span class="token comment">//     get(){</span>
<span class="token comment">//       return 3</span>
<span class="token comment">//     }</span>
<span class="token comment">//   })</span>
<span class="token comment">//   Object.defineProperty(obj,'c',{</span>
<span class="token comment">//     get(){</span>
<span class="token comment">//       return 4</span>
<span class="token comment">//     }</span>
<span class="token comment">//   })</span>
<span class="token comment">// }catch(error){</span>
<span class="token comment">//   console.log(error)</span>
<span class="token comment">// }</span>


<span class="token comment">// 2.通过Reflect.defineProperty操作</span>

<span class="token comment">// 重复定义。不会报错，会通过返回值告诉是否成功。</span>
<span class="token keyword">const</span> x1 <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">3</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>

<span class="token keyword">const</span> x2 <span class="token operator">=</span>  Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span>

<span class="token comment">//捕获错误，直接if即可</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'xxx操作成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'xxx操作失败'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="reactive对比ref"><a href="#reactive对比ref" class="header-anchor">#</a> reactive对比ref</h2> <ul><li>从定义数据角度对比：
<ul><li>ref用来定义：<strong>基本类型数据</strong>。</li> <li>reactive用来定义：<strong>对象（或数组）类型数据</strong>。</li> <li>备注：ref也可以用来定义<strong>对象（或数组）类型数据</strong>，它内部会自动通过<code>reactive</code>转为代理对象。</li></ul></li> <li>从原理角度对比：
<ul><li><code>ref</code>通过<code>Object.defineProperty()</code>的<code>get</code>与<code>set</code>来实现响应式（数据劫持）。</li> <li><code>reactive</code>通过使用<code>Proxy</code>来实现响应式（数据劫持），并通过<code>Reflect</code>操作源对象内部的数据。</li></ul></li> <li>从使用角度对比：
<ul><li>ref定义的数据：操作数据需要<code>.value</code>,读取数据时模板中直接读取不需要<code>.value</code></li> <li>reactive定义的数据：操作数据与读取数据均不需要<code>.value</code></li></ul></li></ul> <h2 id="setup的两个注意点"><a href="#setup的两个注意点" class="header-anchor">#</a> setup的两个注意点</h2> <ul><li>setup执行的时机
<ul><li>在<code>beforeCreate</code>之前执行一次，<code>this</code>是<code>undefined</code>。</li></ul></li> <li>setup的参数
<ul><li><code>props</code>：值为对象，包含：组件外部传递过来，且组件内部声明接收了的属性。</li> <li><code>context</code>：上下文对象
<ul><li><code>attrs</code>:值为对象，包含：组件外部传递过来，但没有在<code>props</code>配置中声明的属性，相当于<code>this.$attrs</code>。</li> <li><code>slots</code>:收到的插槽内容，相当于vue2中<code>this.$slots</code>。</li> <li><code>emit</code>：分发自定义事件的函数，相当于vue2中的<code>this.$emit</code></li></ul></li></ul></li></ul> <p>子组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名{{person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄{{person.age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>触发父组件的hello事件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token string">'school'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//父组件绑定了hello事件</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// props 父组件传过来的参数</span>
   <span class="token comment">// context.attrs 等同于vue2中的$attrs,props没有接收的参数会出现在这里</span>
   <span class="token comment">// context.emit 触发自定义事件</span>

   <span class="token comment">// constext.slots 等同于vue2中的$slots,插槽的虚拟dom</span>
   <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
     age<span class="token operator">:</span><span class="token number">18</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>


   <span class="token comment">// 方法</span>
   <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     context<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">return</span> <span class="token punctuation">{</span>
     person<span class="token punctuation">,</span>
     test
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>父组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Demo</span> <span class="token attr-name">@hello</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>showHelloMsg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">msg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>你好啊<span class="token punctuation">&quot;</span></span> <span class="token attr-name">school</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>嘻嘻嘻<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>111111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--vue3不推荐写法 slot=&quot;qwe&quot;&gt;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>qwe<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--vue3推荐写法 v-slot:qwe&gt;--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>qwe</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Demo</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> Demo <span class="token keyword">from</span> <span class="token string">'./components/Demo'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;App&quot;</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span><span class="token punctuation">{</span>Demo<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token keyword">function</span> <span class="token function">showHelloMsg</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>
    showHelloMsg
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="计算属性与监视"><a href="#计算属性与监视" class="header-anchor">#</a> 计算属性与监视</h2> <h3 id="computed函数"><a href="#computed函数" class="header-anchor">#</a> computed函数</h3> <ul><li>与vue2中computed配置功能一致</li> <li>写法如下：</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  姓：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.firstName<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
  名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.lastName<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>全名：{{person.fullName}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>computed<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

   <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     firstName<span class="token operator">:</span><span class="token string">'张'</span><span class="token punctuation">,</span>
     lastName<span class="token operator">:</span><span class="token string">'三'</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 计算属性</span>
    <span class="token comment">// // 计算属性-简写（没有考虑计算属性被修改的情况）</span>
    <span class="token comment">// person.fullName = computed(()=&gt;{</span>
    <span class="token comment">//   return person.firstName + '-' + person.lastName</span>
    <span class="token comment">// })</span>

    <span class="token comment">// 计算属性-完整写法（考虑读和写）</span>
    person<span class="token punctuation">.</span>fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> nameArr <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
        person<span class="token punctuation">.</span>firstName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        person<span class="token punctuation">.</span>lastName <span class="token operator">=</span> nameArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

   <span class="token keyword">return</span> <span class="token punctuation">{</span>
     person
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="watch函数"><a href="#watch函数" class="header-anchor">#</a> watch函数</h3> <ul><li>与<code>vue2</code>中<code>watch</code>配置功能一致</li> <li>两个小坑
<ul><li>监视<code>reactive</code>定义的响应式数据时：<code>oldValue</code>无法正确获取、强制开启的深度监视（<code>deep</code>配置失效）</li> <li>监视<code>reactive</code>定义的响应式数据中某个属性时：<code>deep</code>配置有效。</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前的信息为：{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg+='!'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{person.age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{person.job.j1.salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.job.j1.salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//情况一： 监视ref所定义的一个响应式数据</span>
    <span class="token comment">// watch(sum,(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   console.log('sum变了'，newValue,oldValue)</span>
    <span class="token comment">// })</span>


    <span class="token comment">// 情况二： 监视ref所定义的多个响应式数据</span>
    <span class="token comment">// watch([sum,msg],(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   // console.log('sum或msg变了'，newValue,oldValue)</span>
    <span class="token comment">//   // newValue,oldValue 是数组</span>
    <span class="token comment">// })</span>

    <span class="token comment">// watch可以通过传递第三个参数添加配置项</span>
    <span class="token comment">// watch(sum,(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//     console.log('sum变了'，newValue,oldValue)</span>
    <span class="token comment">// },{immediate:true,deep:true})</span>


    <span class="token comment">// 情况三：监视reactive所定义的一个响应式数据全部属性</span>
    <span class="token comment">// 注意：</span>
    <span class="token comment">// 1.此处无法正确的获取oldValue</span>
    <span class="token comment">// 2.强制开启了深度监视（deep配置无效）</span>
    <span class="token comment">// watch(person.value,(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   console.log('person变化了',newValue,oldValue)</span>
    <span class="token comment">// })</span>


    <span class="token comment">// 情况四：监视reactive所定义的一个响应式数据中的某个属性</span>
    <span class="token comment">// watch(()=&gt;person.age,(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   console.log('person的age变化了',newValue,oldValue)</span>
    <span class="token comment">// })</span>


    <span class="token comment">// 情况五：监视reactive所定义的一个响应式数据中的某些属性</span>
    <span class="token comment">// watch([()=&gt;person.age,()=&gt;person.name],(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   console.log('person的age或person的name变化了',newValue,oldValue)</span>
    <span class="token comment">// })</span>


    <span class="token comment">// 特殊情况</span>
    <span class="token comment">// 此处由于监视的是reactive定义的对象中的某个属性，所以deep配置有效</span>
    <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>person<span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person的job变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>deep<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">,</span>
      msg<span class="token punctuation">,</span>
      person
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>watch时的value问题</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前的信息为：{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg+='!'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{person.age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{person.job.j1.salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.job.j1.salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//情况一： 监视ref所定义的一个响应式数据</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sum变了'</span>，newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>


    <span class="token function">watch</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>deep<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 或</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>value<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span>oldValue</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person变化了'</span><span class="token punctuation">,</span>newValue<span class="token punctuation">,</span>oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>



    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">,</span>
      msg<span class="token punctuation">,</span>
      person
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="watcheffect函数"><a href="#watcheffect函数" class="header-anchor">#</a> watchEffect函数</h3> <ul><li><code>watch</code>的套路是：既要指明监视的属性，也要指明监视的回调。</li> <li><code>watchEffect</code>的套路是：不用指明监视哪个属性，监视的回调中用到哪个属性，那就监视哪个属性。</li> <li><code>watchEffect</code>有点像<code>computed</code> <ul><li>但<code>computed</code>注重的计算出来的值（回调函数的返回值），所以必须要写返回值。</li> <li>而<code>watchEffect</code>更注重的是过程（回调函数的函数体），所以不用写返回值。</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前的信息为：{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg+='!'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改信息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{person.age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{person.job.j1.salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.job.j1.salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>watch<span class="token punctuation">,</span>watchEffect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'你好啊'</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//watch监视</span>
    <span class="token comment">// watch(sum,(newValue,oldValue)=&gt;{</span>
    <span class="token comment">//   console.log('sum变了'，newValue,oldValue)</span>
    <span class="token comment">// },{immediate:true})</span>

    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> x1 <span class="token operator">=</span> sum<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">const</span> x2 <span class="token operator">=</span> person<span class="token punctuation">.</span>job<span class="token punctuation">.</span>j1<span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watchEffect所指定的回调执行了'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>


    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum<span class="token punctuation">,</span>
      msg<span class="token punctuation">,</span>
      person
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <ul><li><code>vue3</code>中可以继续使用<code>vue2</code>中的生命周期钩子，但是有两个被更名
<ul><li><code>beforeDestroy</code> 改名为 <code>beforeUnmount</code></li> <li><code>destroyed</code> 改名为 <code>unmounted</code></li></ul></li> <li><code>vue3</code>也提供了<code>Composition API</code>形式的生命周期钩子，与<code>vue2</code>中钩子对应关系如下
<ul><li><code>beforeCreate</code> ---&gt; <code>setup()</code></li> <li><code>created</code> ---&gt; <code>setup()</code></li> <li><code>beforeMount</code> ---&gt; <code>onBeforeMount</code></li> <li><code>mounted</code> ---&gt; <code>onMounted</code></li> <li><code>beforeUpdate</code> ---&gt; <code>onBeforeUpdate</code></li> <li><code>updated</code> ---&gt; <code>onUpdated</code></li> <li><code>beforeUnmount</code> ---&gt; <code>onBeforeUnmount</code></li> <li><code>unmounted</code> ---&gt; <code>onUnmounted</code></li></ul></li></ul> <p>通过配置项的形式使用生命周期钩子</p> <ul><li>配置项情况 beforeCreate 在 created 之前执行</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 通过配置项的形式使用生命周期钩子</span>
  <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过组合式API的形式使用生命周期钩子</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前求和为：{{sum}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>onBeforeMount<span class="token punctuation">,</span>onMounted<span class="token punctuation">,</span>onBeforeUpdate<span class="token punctuation">,</span>onUpdated<span class="token punctuation">,</span>onBeforeUnmount<span class="token punctuation">,</span>onUnmounted<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">// 通过组合式API的形式去使用生命周期钩子</span>
    <span class="token function">onBeforeMount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 函数体</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 函数体</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>


    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sum
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>组合API生命周期可与配置项生命周期一起混用，组合API生命周期执行顺序比配置项的快点。如下：</p> <ul><li>挂载顺序</li></ul> <blockquote><p>setup
beforeCreate
created
onBeforeMount
beforeMount
onMounted
mounted</p></blockquote> <ul><li>更新顺序</li></ul> <blockquote><p>onBeforeUpdate
beforeUpdate
onUpdated
updated</p></blockquote> <ul><li>卸载顺序</li></ul> <blockquote><p>onBeforeUnmount
beforeUnmount
onUnmounted
unmounted</p></blockquote> <h2 id="自定义hooks函数"><a href="#自定义hooks函数" class="header-anchor">#</a> 自定义hooks函数</h2> <h3 id="什么是hook"><a href="#什么是hook" class="header-anchor">#</a> 什么是hook?</h3> <ul><li>什么是hook?————本质是一个函数，把<code>setup</code>函数中使用的<code>composition API</code>进行了封装。</li> <li>类似于<code>vue</code>中的<code>mixin</code>。</li> <li>自定义<code>hooks</code>的优势：复用代码，让<code>setup</code>中的逻辑更清楚易懂。</li></ul> <p>原本写法：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前点击时鼠标的坐标为：x:{{point.x}}  y:{{point.y}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">,</span>reactive<span class="token punctuation">,</span>onMounted<span class="token punctuation">,</span>onBeforeUnmount<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'Demo'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
      y<span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword">function</span> <span class="token function">savePoint</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        point<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>pageX
        point<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>pageY
    <span class="token punctuation">}</span>

    <span class="token comment">// 挂载完毕</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>savePoint
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 卸载前</span>
    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>savePoint<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span><span class="token punctuation">{</span>
      sum<span class="token punctuation">,</span>
      point
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>hooks写法:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sum++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点我+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前点击时鼠标的坐标为：x:{{point.x}}  y:{{point.y}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> usePoint <span class="token keyword">from</span> <span class="token string">'../hooks/usePoint'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'Demo'</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">usePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span><span class="token punctuation">{</span>
      sum<span class="token punctuation">,</span>
      point
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//hooks/usePoint.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>reactive<span class="token punctuation">,</span>onMounted<span class="token punctuation">,</span>onBeforeUnmount<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">savePoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 实现鼠标“打点”</span>
   <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      x<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
      y<span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 方法</span>
    <span class="token keyword">function</span> <span class="token function">savePoint</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        point<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>pageX
        point<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>pageY
    <span class="token punctuation">}</span>

    <span class="token comment">// 挂载完毕</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>savePoint
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 卸载前</span>
    <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>savePoint<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> point<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> savePoint
</code></pre></div><h2 id="toref"><a href="#toref" class="header-anchor">#</a> toRef</h2> <ul><li>作用：创建一个<code>ref</code>对象，其<code>value</code>值指向另一个对象中的某个属性。</li> <li>语法：<code>const name = toRef(person,'name')</code></li> <li>应用：要将响应式对象中的某个属性单独提供给外部使用时。</li> <li>扩展：<code>toRefs</code>与<code>toRef</code>功能一致，但可以批量创建多个<code>ref</code>对象，语法：<code>toRefs(person)</code></li></ul> <p>不用toRef</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{person.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{person.age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{person.job.j1.salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person.job.j1.salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>reactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>




    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      person
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用toRef</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>reactive<span class="token punctuation">,</span>toRef<span class="token punctuation">,</span>toRefs<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// name 为 RefImpl{...value}</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token function">toRef</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token function">toRef</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span>
      salary<span class="token operator">:</span><span class="token function">toRef</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>job<span class="token punctuation">.</span>j1<span class="token punctuation">,</span><span class="token string">'salary'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>用toRefs</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>姓名：{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>年龄：{{age}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>薪资：{{job.j1.salary}}k<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name+='~'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>age++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长年龄<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>salary++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>增长薪资<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>reactive<span class="token punctuation">,</span>toRef<span class="token punctuation">,</span>toRefs<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">,</span>
      job<span class="token operator">:</span><span class="token punctuation">{</span>
        j1<span class="token operator">:</span><span class="token punctuation">{</span>
          salary<span class="token operator">:</span><span class="token number">20</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
     <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="composition-api的优势"><a href="#composition-api的优势" class="header-anchor">#</a> Composition API的优势</h2> <h3 id="options-api-存在的问题"><a href="#options-api-存在的问题" class="header-anchor">#</a> Options API 存在的问题</h3> <p>使用传统的Options API中，新增或修改一个需求，就需要分别在<code>data</code>、<code>methods</code>、<code>computed</code>等里修改。</p> <h3 id="composition-api-的优势"><a href="#composition-api-的优势" class="header-anchor">#</a> Composition API 的优势</h3> <p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/12/2023, 9:41:13 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vue/vue3/base.html" class="prev">初识vue3</a></span> <span class="next"><a href="/vue/vue3/otherComAPI.html">other Composition API</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ce52274a.js" defer></script><script src="/assets/js/2.86be4830.js" defer></script><script src="/assets/js/72.4039c758.js" defer></script>
  </body>
</html>
